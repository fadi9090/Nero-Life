
{% assign current_variant = product.selected_or_first_available_variant %}

<div class="bg-[#F5F5DC] py-10">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="lg:grid lg:grid-cols-2 lg:gap-x-8 lg:items-start">
      <div class="flex flex-col-reverse">
        <div class="aspect-w-1 aspect-h-1 w-full rounded-lg overflow-hidden">
          {% if current_variant.featured_image %}
            <img src="{{ current_variant.featured_image | img_url: '1024x1024' }}" 
                 alt="{{ current_variant.featured_image.alt | escape }}" 
                 class="w-full h-full object-center object-cover"
                 width="250" height="250">
          {% else %}
            {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-center object-cover' }}
          {% endif %}
        </div>
        <div class="hidden mt-6 w-full max-w-2xl mx-auto sm:block lg:max-w-none">
          <div class="grid grid-cols-4 gap-6">
            {% for media in product.media %}
              {% if media.media_type == 'image' %} 
                <div class="relative h-24 bg-white rounded-lg flex items-center justify-center cursor-pointer overflow-hidden border border-gray-200 hover:border-[#0077B6]">
                  <img src="{{ media | img_url: 'medium' }}" 
                       alt="{{ media.alt | escape }}" 
                       class="w-full h-full object-cover object-center"
                       width="45" height="45">
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        
      </div>
      <div class="mt-10 px-4 sm:px-0 sm:mt-16 lg:mt-0">
        <h1 class="text-4xl font-extrabold tracking-tight text-black">{{ product.title }}</h1>

        <div class="mt-3">
          <h2 class="sr-only">Product information</h2>
          <p class="text-3xl text-black">{{ current_variant.price | money }}</p>
        </div>
        <div class="mt-3">
          <h3 class="sr-only">Reviews</h3>
          <div class="flex items-center">
            <div class="flex items-center">
              {% render 'icon-star' %}{% render 'icon-star' %}{% render 'icon-star' %}{% render 'icon-star' %}{% render 'icon-star' %}
            </div>
            <p class="sr-only">4.5 out of 5 stars</p>
            <a href="#" class="ml-3 text-sm font-medium text-[#0077B6] hover:text-black">Read 45 reviews</a>
          </div>
        </div>
        <div class="mt-10">
          <h3 class="sr-only">Options</h3>
          
          {% form 'product', product, id: 'product-form', class: 'mt-4' %}
            <input type="hidden" name="id" value="{{ current_variant.id }}">
            {% unless product.has_only_default_variant %}
              {% for option in product.options_with_values %}
                <div class="mt-8">
                  <h4 class="text-sm font-medium text-black">{{ option.name }}</h4>
                  <div class="flex items-center space-x-3 mt-4">
                    {% for value in option.values %}
                      {% assign variant_available = true %}
                      {% for variant in product.variants %}
                        {% if variant.options contains value %}
                          {% unless variant.available %}
                            {% assign variant_available = false %}
                          {% endunless %}
                        {% endif %}
                      {% endfor %}

                      <button type="button" 
                              class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium 
                                     {% if variant_available %}
                                       {% if current_variant.options contains value %}
                                         bg-black text-[#F5F5DC] border border-black 
                                       {% else %}
                                         bg-white text-black border border-gray-300 hover:bg-gray-100 
                                       {% endif %}
                                     {% else %}
                                       bg-gray-100 text-gray-400 border border-gray-200 cursor-not-allowed
                                     {% endif %}
                                     "
                              data-option-name="{{ option.name }}" 
                              data-option-value="{{ value }}"
                              {% if variant_available %}
                                @click="selectVariantOption('{{ option.name }}', '{{ value }}')" 
                              {% endif %}
                              aria-label="Select {{ option.name }} {{ value }}"
                              {% if not variant_available %}disabled{% endif %}
                              >
                        {{ value }}
                      </button>
                    {% endfor %}
                  </div>
                </div>
              {% endfor %}
            {% endunless %}
            <div class="mt-8">
              <label for="quantity" class="text-sm font-medium text-black">Quantity</label>
              <input type="number" id="quantity" name="quantity" value="1" min="1" class="w-20 mt-2 p-2 border border-gray-400 rounded-md text-black focus:ring-[#0077B6] focus:border-[#0077B6]">
            </div>
            <div class="mt-10">
              <button type="submit" name="add" 
                      class="w-full bg-black border border-transparent rounded-md py-3 px-8 flex items-center justify-center 
                             text-base font-medium text-[#F5F5DC] hover:bg-[#FA8072] hover:text-black 
                             transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FA8072]">
                Add to Bag
              </button>
            </div>
          {% endform %}
        </div>
        <div x-data="{ activeTab: 'description' }" class="mt-12 border-t border-gray-200 pt-10">
            <div class="flex border-b border-gray-300">
                <button @click="activeTab = 'description'" 
                        :class="{'border-b-2 border-black font-semibold text-black': activeTab === 'description', 'text-gray-500': activeTab !== 'description'}"
                        class="px-4 py-2 transition duration-300">Description</button>
                
                <button @click="activeTab = 'reviews'" 
                        :class="{'border-b-2 border-black font-semibold text-black': activeTab === 'reviews', 'text-gray-500': activeTab !== 'reviews'}"
                        class="px-4 py-2 transition duration-300">Reviews</button>
            </div>
            
            <div x-show="activeTab === 'description'" class="py-6 text-base text-gray-700">
                {{ product.description }}
                <div class="mt-6 space-y-4">
                    <h3 class="text-lg font-medium text-black border-t pt-4">Fabric & Care</h3>
                    <p class="text-sm">100% Cotton. Machine wash cold, tumble dry low.</p>
                </div>
            </div>
            
            <div x-show="activeTab === 'reviews'" class="py-6">
                {# This is where your external review app widget code would go #}
                {% render 'product-reviews-widget' %}
                <p class="text-sm text-gray-600 mt-2">Displaying 5 of 45 verified reviews.</p>
            </div>
        </div>        
      </div>
    </div>
  </div>
</div>

<script>
  function selectVariantOption(optionName, optionValue) {
    console.log(`Selected ${optionName}: ${optionValue}`);
    // This function needs robust Shopify variant selection logic to work fully.
  }
</script>