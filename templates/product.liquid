<div class="bg-[#F5F5DC] py-10 px-4 sm:px-8 lg:px-12">
    <div class="max-w-7xl mx-auto flex flex-col lg:flex-row lg:justify-between lg:gap-10">

        <!-- 1. PRODUCT MEDIA GALLERY (Left Column) -->
        <div class="w-full lg:w-1/2 mb-6 lg:mb-0">
            <div class="bg-white rounded-xl shadow-lg p-4 flex flex-col items-center">

                <!-- Main Image Display Area -->
                <div class="w-full h-80 sm:h-96 flex items-center justify-center mb-4">
                    <img id="media-display"
                         src="{{ product.featured_media | img_url: '1024x1024' }}" 
                         alt="{{ product.featured_media.alt | escape }}"
                         class="max-h-full max-w-full object-contain rounded-lg transition-opacity duration-300"
                         onerror="this.onerror=null; this.src='https://placehold.co/600x600/f0f0f0/000000?text=Image+Load+Error';"
                    />
                </div>

                <!-- Thumbnails Area (Horizontal Scrollable Row) -->
                <div id="thumbnails-container"
                    class="w-full flex space-x-3 overflow-x-auto no-scrollbar pb-1 justify-start sm:justify-center"
                >
                    
                    <!-- Loop through ALL media associated with the product -->
                    {% for media in product.media %}
                        
                        <!-- Check if the current media item is the featured media to set the initial active class -->
                        {% assign is_active = false %}
                        {% if product.featured_media.id == media.id %}
                            {% assign is_active = true %}
                        {% endif %}
                        
                        <img src="{{ media.preview_image | img_url: 'medium' }}" 
                            alt="{{ media.alt | escape }}" 
                            data-full-url="{{ media | img_url: '1024x1024' }}"
                            data-media-id="{{ media.id }}"
                            class="media-thumbnail w-16 h-16 flex-shrink-0 object-cover rounded-lg cursor-pointer transition-all duration-200 hover:scale-105 hover:opacity-100 
                                    {% if is_active %}
                                        border-blue-600 border-2 ring-2 ring-blue-600/50 shadow-md 
                                    {% else %}
                                        border-gray-300 border opacity-75
                                    {% endif %}"
                            onclick="swapMedia(this, '{{ media | img_url: '1024x1024' }}')"
                        />
                    {% endfor %}
                    
                </div>
            </div>
        </div>

        <!-- 2. PRODUCT INFO & CTA (Right Column) -->
        <div class="w-full lg:w-1/2 p-6 border rounded-xl shadow-sm bg-white"> 
            
            <h1 class="text-3xl font-extrabold mb-4 text-gray-900">
                {{ product.title }}
            </h1>

            <!-- Price Display -->
            <div class="mt-2 mb-6">
                {% if product.compare_at_price > product.price %}
                    <span class="text-xl font-bold text-red-600">
                        {{ product.price | money }}
                    </span>
                    <span class="text-base line-through text-gray-500 ml-2">
                        {{ product.compare_at_price | money }}
                    </span>
                {% else %}
                    <span class="text-xl font-bold text-gray-900">
                        {{ product.price | money }}
                    </span>
                {% endif %} 
            </div>

            <!-- Add to Cart Button -->
            <div class="mt-8">
                <button class="bg-[#FA8072] text-white p-4 rounded-xl w-full text-lg font-semibold shadow-md hover:bg-[#E57365] transition duration-200">
                    Add to Cart
                </button>
            </div>
            
        </div>
        
    </div>

    <!-- 3. PRODUCT DESCRIPTION SECTION (Full Width below the main content) -->
    <div class="bg-white p-8 max-w-7xl mx-auto mt-10 rounded-xl shadow-lg border border-gray-100">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Product Description</h2>
        <div class="text-base leading-relaxed text-gray-600 prose">
            {{ product.description }}
        </div>
    </div>

</div> <!-- End of bg-[#F5F5DC] container -->

<script>
    /**
     * Swaps the main product image and updates the active state of the thumbnails.
     * @param {HTMLElement} clickedThumb - The thumbnail element that was clicked.
     * @param {string} fullImageUrl - The full-size URL for the new main image.
     */
    function swapMedia(clickedThumb, fullImageUrl) {
        const display = document.getElementById('media-display');
        
        // 1. Update main image source and alt text
        display.src = fullImageUrl;
        display.alt = clickedThumb.alt;
        
        // 2. Update active state for all thumbnails
        document.querySelectorAll('.media-thumbnail').forEach(thumb => {
            // Remove active classes (blue border)
            thumb.classList.remove('border-blue-600', 'border-2', 'ring-2', 'ring-blue-600/50', 'shadow-md');
            // Add inactive styling (gray border, lower opacity)
            thumb.classList.add('border-gray-300', 'border', 'opacity-75');
        });
        
        // 3. Apply active state to the clicked thumbnail
        clickedThumb.classList.add('border-blue-600', 'border-2', 'ring-2', 'ring-blue-600/50', 'shadow-md');
        clickedThumb.classList.remove('border-gray-300', 'border', 'opacity-75');
    }

    // Safely inject styles for scrollbar hiding if not already present
    let scrollbarStyle = document.getElementById('scrollbar-style-fix');
    
    if (!scrollbarStyle) {
        const style = document.createElement('style');
        style.id = 'scrollbar-style-fix';
        style.innerHTML = `
            .no-scrollbar::-webkit-scrollbar { display: none; }
            .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        `;
        document.head.appendChild(style);
    }
</script>