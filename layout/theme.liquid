<!doctype html>
<html>
  <head>
    <title>{{ page_title }}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="{{ page_description | escape }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    {{ content_for_header }}
    <!-- Header hook for plugins -->
    {{ 'application.css' | asset_url | stylesheet_tag }}
    {{ 'application.js' | asset_url | script_tag }}
    <!-- Keep only one Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body class="bg-[#F5F5DC] font-sans font-bold text-white flex flex-col min-h-screen">
    {% section 'announcement-bar' %}
    {% section 'header' %}
    <main role="main" class="flex-grow">
      {{ content_for_layout }}
    </main>
    
    {% section 'footer' %}

    {% section 'cart-drawer' %}

    <!-- Temporary test button -->
    <button onclick="testCartFunctions()" 
            style="position: fixed; bottom: 20px; left: 20px; background: #FA8072; color: white; padding: 10px; z-index: 99999; border-radius: 5px;">
        Test Cart Functions
    </button>

    <script>
      // Global cart functions
      window.cartFunctionsLoaded = true;

      // Dispatch cart update events
      function dispatchCartUpdated(count) {
          const event = new CustomEvent('cart:updated', { detail: { item_count: count } });
          document.dispatchEvent(event);
      }

      // Shopify money formatting helper
      if (!window.Shopify) window.Shopify = {};
      Shopify.formatMoney = function(cents, format) {
          if (typeof cents === 'string') cents = cents.replace('.', '');
          var value = '';
          var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
          var formatString = (format || this.money_format);

          function defaultOption(opt, def) {
              return (typeof opt === 'undefined' ? def : opt);
          }

          function formatWithDelimiters(number, precision, thousands, decimal) {
              precision = defaultOption(precision, 2);
              thousands = defaultOption(thousands, ',');
              decimal = defaultOption(decimal, '.');

              if (isNaN(number) || number === null) return 0;

              number = (number / 100.0).toFixed(precision);

              var parts = number.split('.');
              var dollars = parts[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1' + thousands);
              var cents = parts[1] ? (decimal + parts[1]) : '';

              return dollars + cents;
          }

          switch (formatString.match(placeholderRegex)[1]) {
              case 'amount':
                  value = formatWithDelimiters(cents, 2);
                  break;
              case 'amount_no_decimals':
                  value = formatWithDelimiters(cents, 0);
                  break;
              case 'amount_with_comma_separator':
                  value = formatWithDelimiters(cents, 2, '.', ',');
                  break;
              case 'amount_no_decimals_with_comma_separator':
                  value = formatWithDelimiters(cents, 0, '.', ',');
                  break;
          }

          return formatString.replace(placeholderRegex, value);
      };

      // Test cart functions
      function testCartFunctions() {
          console.log('=== Testing Cart Functions ===');
          console.log('toggleCartDrawer exists:', typeof toggleCartDrawer);
          console.log('openCartDrawer exists:', typeof openCartDrawer);
          console.log('CartDrawer element:', document.getElementById('CartDrawer'));
          
          // Test opening cart drawer
          if (typeof toggleCartDrawer === 'function') {
              console.log('Calling toggleCartDrawer()...');
              toggleCartDrawer();
          } else {
              console.error('toggleCartDrawer is not a function!');
          }
      }
    </script>
  </body>
</html>