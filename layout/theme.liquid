<!doctype html>
<html>
  <head>
    <title>{{ page_title }}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="{{ page_description | escape }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    {{ content_for_header }}
    <!-- Header hook for plugins -->
    {{ 'application.css' | asset_url | stylesheet_tag }}
    {{ 'led-mask.js' | asset_url | script_tag }}
    <!-- Keep only one Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Add CSS to fix black overlay issue -->
    <style>
      /* Fix for cart drawer overlay */
      #CartDrawerOverlay {
        opacity: 1 !important;
        background-color: rgba(0, 0, 0, 0.5) !important;
      }
      
      /* Ensure cart drawer content is visible */
      #CartDrawerContent {
        background-color: #F5F5DC !important;
        color: #000000 !important;
      }
      
      /* Fix text colors in cart drawer */
      #CartDrawerContent * {
        color: #000000 !important;
      }
      
      /* Fix links in cart drawer */
      #CartDrawerContent a {
        color: #0077B6 !important;
      }
      
      #CartDrawerContent a:hover {
        color: #FA8072 !important;
      }
      
      /* Fix button colors */
      #CartDrawerContent button {
        color: #000000 !important;
      }
      
      /* Fix input colors */
      #CartDrawerContent input {
        color: #000000 !important;
        background-color: white !important;
        border-color: #ccc !important;
      }
    </style>
  </head>
  <body class="bg-[#F5F5DC] font-sans font-bold text-white flex flex-col min-h-screen">
    {% section 'announcement-bar' %}
    {% section 'header' %}
    
    <main role="main" class="flex-grow">
      {{ content_for_layout }}
    </main>
    {% if request.page_type == 'product' or request.page_type == 'index' %}
      {% section 'floating-buttons' %}
    {% endif %}
    {{ 'floating-buttons.js' | asset_url | script_tag }}
    {% section 'footer' %}
  </body>

  <script>
    // Simple cart count updater
    document.addEventListener('DOMContentLoaded', function() {
        // Listen for cart updates
        document.addEventListener('cart:updated', function() {
            // Reload cart count from Shopify
            fetch('/cart.js')
                .then(response => response.json())
                .then(cart => {
                    const cartCount = document.getElementById('CartCount');
                    const cartCountWrapper = document.getElementById('CartCountWrapper');
                    
                    if (cart.item_count > 0) {
                        if (cartCount) {
                            cartCount.textContent = cart.item_count;
                        } else if (cartCountWrapper) {
                            cartCountWrapper.innerHTML = `
                                <span id="CartCount" class="cart-count text-xs font-bold text-white bg-red-600 rounded-full w-5 h-5 flex items-center justify-center absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2">
                                    ${cart.item_count}
                                </span>
                            `;
                        }
                    } else {
                        if (cartCount) cartCount.remove();
                    }
                });
        });
    });
  </script>
</html>