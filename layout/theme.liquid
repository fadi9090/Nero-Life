<!doctype html>
<html>
  <head>
    <title>{{ page_title }}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="{{ page_description | escape }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    {{ content_for_header }}
    <!-- Header hook for plugins -->
    {{ 'application.css' | asset_url | stylesheet_tag }}
    {{ 'application.js' | asset_url | script_tag }}
    <!-- Keep only one Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Add CSS to fix black overlay issue -->
    <style>
      /* Fix for cart drawer overlay */
      #CartDrawerOverlay {
        opacity: 1 !important;
        background-color: rgba(0, 0, 0, 0.5) !important;
      }
      
      /* Ensure cart drawer content is visible */
      #CartDrawerContent {
        background-color: #F5F5DC !important;
        color: #000000 !important;
      }
      
      /* Fix text colors in cart drawer */
      #CartDrawerContent * {
        color: #000000 !important;
      }
      
      /* Fix links in cart drawer */
      #CartDrawerContent a {
        color: #0077B6 !important;
      }
      
      #CartDrawerContent a:hover {
        color: #FA8072 !important;
      }
      
      /* Fix button colors */
      #CartDrawerContent button {
        color: #000000 !important;
      }
      
      /* Fix input colors */
      #CartDrawerContent input {
        color: #000000 !important;
        background-color: white !important;
        border-color: #ccc !important;
      }
    </style>
  </head>
  <body class="bg-[#F5F5DC] font-sans font-bold text-white flex flex-col min-h-screen">
    {% section 'announcement-bar' %}
    {% section 'header' %}
    
    {% section 'cart-drawer' %}
    
    <main role="main" class="flex-grow">
      {{ content_for_layout }}
    </main>
    
    {% section 'footer' %}

    <script>
      // Global cart functions
      window.cartFunctionsLoaded = true;

      // Dispatch cart update events
      function dispatchCartUpdated(count) {
          const event = new CustomEvent('cart:updated', { detail: { item_count: count } });
          document.dispatchEvent(event);
      }

      // Shopify money formatting helper
      if (!window.Shopify) window.Shopify = {};
      Shopify.formatMoney = function(cents, format) {
          if (typeof cents === 'string') cents = cents.replace('.', '');
          var value = '';
          var placeholderRegex = /\{\{\s*(\w+)\s*\}\}/;
          var formatString = (format || this.money_format);

          function defaultOption(opt, def) {
              return (typeof opt === 'undefined' ? def : opt);
          }

          function formatWithDelimiters(number, precision, thousands, decimal) {
              precision = defaultOption(precision, 2);
              thousands = defaultOption(thousands, ',');
              decimal = defaultOption(decimal, '.');

              if (isNaN(number) || number === null) return 0;

              number = (number / 100.0).toFixed(precision);

              var parts = number.split('.');
              var dollars = parts[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1' + thousands);
              var cents = parts[1] ? (decimal + parts[1]) : '';

              return dollars + cents;
          }

          switch (formatString.match(placeholderRegex)[1]) {
              case 'amount':
                  value = formatWithDelimiters(cents, 2);
                  break;
              case 'amount_no_decimals':
                  value = formatWithDelimiters(cents, 0);
                  break;
              case 'amount_with_comma_separator':
                  value = formatWithDelimiters(cents, 2, '.', ',');
                  break;
              case 'amount_no_decimals_with_comma_separator':
                  value = formatWithDelimiters(cents, 0, '.', ',');
                  break;
          }

          return formatString.replace(placeholderRegex, value);
      };
    </script>
  </body>
</html>