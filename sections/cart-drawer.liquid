{% if cart.item_count > 0 %}
    {% assign empty_cart_class = '' %}
{% else %}
    {% assign empty_cart_class = 'is-empty' %}
{% endif %}

<div x-data="{ open: false }" 
     id="CartDrawer" 
     x-ref="CartDrawer"
     class="fixed inset-0 z-50 pointer-events-none {{ empty_cart_class }}" 
     aria-modal="true" 
     role="dialog" 
     aria-label="Shopping Cart"
     @keydown.escape.window="open = false">

    <!-- Overlay -->
    <div x-show="open" 
         @click="open = false" 
         x-transition:enter="ease-in-out duration-500"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in-out duration-500"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="absolute inset-0 bg-black bg-opacity-50 transition-opacity">
    </div>

    <!-- Cart Drawer Content -->
    <div x-show="open" 
         x-transition:enter="transform transition ease-in-out duration-500 sm:duration-700"
         x-transition:enter-start="translate-x-full"
         x-transition:enter-end="translate-x-0"
         x-transition:leave="transform transition ease-in-out duration-500 sm:duration-700"
         x-transition:leave-start="translate-x-0"
         x-transition:leave-end="translate-x-full"
         class="absolute right-0 top-0 bottom-0 w-full sm:w-96 overflow-y-auto bg-[#F5F5DC] shadow-xl transform transition-transform duration-300 pointer-events-auto">
        
        <div class="h-full flex flex-col justify-between">
            
            <div class="p-6">
                <div class="flex items-center justify-between border-b pb-4 mb-4">
                    <h2 class="text-2xl font-bold text-black">Your Bag ({{ cart.item_count }})</h2>
                    <button type="button" 
                            @click="open = false" 
                            class="p-2 text-black hover:text-[#0077B6]">
                        âœ•
                    </button>
                </div>

                {% if cart.item_count > 0 %}
                    <form action="{{ routes.cart_url }}" method="post" id="CartDrawerForm">
                        <div class="space-y-4">
                            {% for item in cart.items %}
                                <div class="flex items-start">
                                    <a href="{{ item.url }}" class="w-20 h-20 flex-shrink-0 mr-3">
                                        <img src="{{ item | img_url: 'small' }}" alt="{{ item.title | escape }}" class="w-full h-full object-cover rounded-md border">
                                    </a>
                                    
                                    <div class="flex-grow">
                                        <a href="{{ item.url }}" class="font-medium text-black hover:text-[#0077B6]">{{ item.product.title | truncatewords: 5 }}</a>
                                        <p class="text-sm text-gray-600 mb-1">{{ item.variant.title }}</p>
                                        
                                        <div class="flex items-center justify-between text-sm">
                                            <p class="font-bold text-black">{{ item.line_price | money }}</p>
                                            
                                            <input type="number" 
                                                   name="updates[]" 
                                                   id="updates_{{ item.key }}" 
                                                   value="{{ item.quantity }}" 
                                                   min="1" 
                                                   class="w-12 p-1 border text-center text-black rounded-md"
                                                   aria-label="Quantity">
                                            
                                            <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&quantity=0" 
                                               class="text-xs text-black hover:text-[#FA8072] underline">Remove</a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </form>
                {% else %}
                    <div class="py-10 text-center">
                        <p class="text-lg text-black">Your bag is lonely! Add some products.</p>
                        <a href="{{ routes.all_products_collection_url }}" 
                           @click="open = false"
                           class="mt-4 inline-block text-base font-medium text-black bg-[#FA8072] px-4 py-2 rounded transition duration-300 hover:bg-[#0077B6] hover:text-white">
                            Shop All
                        </a>
                    </div>
                {% endif %}
            </div>

            {% if cart.item_count > 0 %}
                <div class="p-6 border-t bg-white">
                    <div class="flex justify-between text-xl font-bold mb-3">
                        <span>Subtotal:</span>
                        <span class="text-black">{{ cart.total_price | money }}</span>
                    </div>

                    <p class="text-sm text-gray-600 mb-4">Shipping and taxes calculated at checkout.</p>
                    
                    <button type="submit" name="checkout" form="CartDrawerForm"
                            class="w-full p-3 font-semibold text-[#F5F5DC] bg-black rounded transition duration-300 
                                   hover:bg-[#FA8072] hover:text-black shadow-lg">
                        Checkout
                    </button>
                    
                    <a href="{{ routes.cart_url }}" 
                       @click="open = false"
                       class="mt-3 w-full p-3 block text-center border border-black text-black rounded transition duration-300 hover:bg-gray-100">
                       View Full Cart
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>